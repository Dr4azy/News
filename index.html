<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Pro</title>
    <style>
        :root { --bg: #000; --card: #111; --accent: #ffd700; --text: #fff; --border: #333; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; }
        
        /* Header & Nav */
        header { padding: 20px; text-align: center; border-bottom: 1px solid var(--border); }
        .nav-bar { position: sticky; top: 0; z-index: 100; background: var(--bg); padding: 10px; border-bottom: 2px solid var(--accent); display: flex; flex-direction: column; gap: 10px; }
        .row { display: flex; gap: 10px; overflow-x: auto; padding: 5px; }
        
        /* Boutons */
        button { padding: 10px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); cursor: pointer; font-weight: bold; white-space: nowrap; }
        .btn-active { background: var(--accent) !important; color: #000 !important; }
        #archive-toggle-btn { background: #222; border-color: var(--accent); flex-grow: 1; }

        /* Grille d'articles */
        #grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; padding: 20px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 15px; overflow: hidden; display: flex; flex-direction: column; }
        .card img { width: 100%; height: 180px; object-fit: cover; }
        .card-body { padding: 15px; display: flex; flex-direction: column; flex-grow: 1; }
        .card-title { font-size: 1.1rem; margin: 0 0 10px 0; line-height: 1.4; color: var(--accent); text-decoration: none; }
        .meta { font-size: 0.8rem; color: #888; margin-bottom: 15px; }
        
        .actions { margin-top: auto; display: flex; gap: 10px; }
        .btn-read { flex-grow: 2; background: var(--accent); color: #000; }
        .btn-save { flex-grow: 1; }
        .btn-save.saved { background: #ff4444; color: white; border-color: #ff4444; }

        /* Lecteur Modal */
        #modal { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 1000; overflow-y: auto; padding: 20px; }
        .modal-content { max-width: 800px; margin: 0 auto; line-height: 1.6; }
        .close-modal { position: sticky; top: 0; float: right; background: var(--accent); color: #000; padding: 10px 20px; border-radius: 20px; }
    </style>
</head>
<body>

<header><h1>Journal Personnel</h1></header>

<div class="nav-bar">
    <div class="row">
        <input type="text" id="searchInput" placeholder="Rechercher..." style="flex-grow:1; padding: 10px; border-radius: 8px; background: #222; border: 1px solid #444; color: white;">
        <button onclick="location.reload()">ðŸ”„ Actualiser</button>
    </div>
    <div class="row">
        <button id="archive-toggle-btn" onclick="toggleView()">ðŸ“‚ VOIR MES ARTICLES ENREGISTRÃ‰S</button>
    </div>
</div>

<div id="grid"></div>

<div id="modal">
    <button class="close-modal" onclick="closeArticle()">FERMER</button>
    <div id="modal-body" class="modal-content"></div>
</div>

<script>
    // Configuration et Ã‰tat
    const sources = [
        { name: "Le Monde", url: "https://www.lemonde.fr/rss/une.xml" },
        { name: "LibÃ©ration", url: "https://www.liberation.fr/arc/outboundfeeds/rss-all/feed/?" },
        { name: "France Info", url: "https://www.francetvinfo.fr/titres.rss" }
    ];

    let allArticles = []; // Stocke le flux actuel
    let archives = JSON.parse(localStorage.getItem('news_archives')) || []; // Stocke les archives
    let isShowingArchives = false;

    // 1. Chargement des donnÃ©es
    async function fetchNews() {
        const grid = document.getElementById('grid');
        grid.innerHTML = "<p>Chargement des actualitÃ©s...</p>";

        try {
            const results = await Promise.all(sources.map(s => 
                fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(s.url)}`)
                .then(r => r.json())
                .then(data => data.items.map(item => ({
                    id: item.guid || item.link,
                    title: item.title,
                    link: item.link,
                    img: item.enclosure?.link || item.thumbnail || 'https://via.placeholder.com/400x200?text=News',
                    source: s.name,
                    date: item.pubDate,
                    content: item.content || item.description
                })))
            ));

            // MÃ©lange des sources (Entrelacement)
            allArticles = [];
            const maxLength = Math.max(...results.map(r => r.length));
            for(let i=0; i<maxLength; i++) {
                results.forEach(sourceList => {
                    if(sourceList[i]) allArticles.push(sourceList[i]);
                });
            }

            render();
        } catch (e) {
            grid.innerHTML = "<p>Erreur de connexion.</p>";
        }
    }

    // 2. Affichage
    function render() {
        const grid = document.getElementById('grid');
        const listToDisplay = isShowingArchives ? archives : allArticles;
        
        if (listToDisplay.length === 0 && isShowingArchives) {
            grid.innerHTML = "<p style='text-align:center; padding:50px;'>Aucun article dans vos archives pour le moment.</p>";
            return;
        }

        grid.innerHTML = listToDisplay.map(art => {
            const isSaved = archives.some(a => a.id === art.id);
            return `
                <div class="card">
                    <img src="${art.img}" alt="">
                    <div class="card-body">
                        <div class="meta">${art.source} â€¢ ${new Date(art.date).toLocaleDateString('fr-FR', {day:'2-digit', month:'2-digit', year:'numeric'})}</div>
                        <a href="#" class="card-title" onclick="openArticle('${encodeURIComponent(art.id)}')">${art.title}</a>
                        <div class="actions">
                            <button class="btn-read" onclick="openArticle('${encodeURIComponent(art.id)}')">LIRE</button>
                            <button class="btn-save ${isSaved ? 'saved' : ''}" onclick="toggleArchive('${encodeURIComponent(art.id)}')">
                                ${isSaved ? 'SUPPRIMER' : 'ARCHIVER'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // 3. Logique d'archivage
    function toggleArchive(encodedId) {
        const id = decodeURIComponent(encodedId);
        const archiveIndex = archives.findIndex(a => a.id === id);

        if (archiveIndex > -1) {
            // Supprimer des archives
            archives.splice(archiveIndex, 1);
        } else {
            // Ajouter aux archives
            const article = allArticles.find(a => a.id === id);
            if (article) archives.push(article);
        }

        // Sauvegarde permanente
        localStorage.setItem('news_archives', JSON.stringify(archives));
        render(); // RafraÃ®chir l'affichage
    }

    // 4. Basculer la vue
    function toggleView() {
        isShowingArchives = !isShowingArchives;
        const btn = document.getElementById('archive-toggle-btn');
        
        if (isShowingArchives) {
            btn.innerHTML = "ðŸ—žï¸ RETOUR AU FLUX D'ACTUALITÃ‰S";
            btn.classList.add('btn-active');
        } else {
            btn.innerHTML = "ðŸ“‚ VOIR MES ARTICLES ENREGISTRÃ‰S";
            btn.classList.remove('btn-active');
        }
        render();
    }

    // 5. Lecteur d'article
    function openArticle(encodedId) {
        const id = decodeURIComponent(encodedId);
        const art = (isShowingArchives ? archives : allArticles).find(a => a.id === id);
        if (!art) return;

        document.getElementById('modal-body').innerHTML = `
            <h1 style="color:var(--accent)">${art.title}</h1>
            <p style="color:#888">${art.source} - ${art.date}</p>
            <hr border="1" color="#333">
            <div style="font-size:1.2rem">${art.content}</div>
            <br><a href="${art.link}" target="_blank" style="color:var(--accent)">Lire l'original sur le site source â†—</a>
        `;
        document.getElementById('modal').style.display = 'block';
        document.body.style.overflow = 'hidden';
    }

    function closeArticle() {
        document.getElementById('modal').style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    // Lancement
    fetchNews();

    // Recherche dynamique
    document.getElementById('searchInput').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const cards = document.querySelectorAll('.card');
        cards.forEach(card => {
            const title = card.querySelector('.card-title').innerText.toLowerCase();
            card.style.display = title.includes(term) ? 'flex' : 'none';
        });
    });
</script>

</body>
</html>
